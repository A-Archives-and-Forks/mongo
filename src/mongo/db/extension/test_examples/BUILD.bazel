load("//bazel:mongo_src_rules.bzl", "mongo_cc_extension_shared_library", "mongo_cc_library", "mongo_cc_unit_test")

package(default_visibility = ["//visibility:public"])

# Extensions under test_examples/
[
    mongo_cc_extension_shared_library(
        name = extension_name + "_mongo_extension",
        srcs = [extension_name + ".cpp"],
    )
    for extension_name in [
        "foo",
        "bar",
        # TODO SERVER-109108: Remove this entry when the buzz extension is no longer needed.
        "buzz",
    ]
]

# Extensions under test_examples/loading/
[
    mongo_cc_extension_shared_library(
        name = extension_name + "_mongo_extension",
        srcs = ["loading/" + extension_name + ".cpp"],
    )
    for extension_name in [
        "hostVersionSucceeds",
        "loadTwoStages",
    ]
]

# Extensions under test_examples/fail_to_load/
# Each of these should fail startup.
[
    mongo_cc_extension_shared_library(
        name = extension_name + "_bad_extension",
        srcs = ["fail_to_load/" + extension_name + ".cpp"],
    )
    for extension_name in [
        "no_symbol",
        "null_mongo_extension",
        "major_version_too_high",
        "major_version_too_low",
        "minor_version_too_high",
        "null_initialize_function",
        "major_version_max_int",
        "duplicate_stage_descriptor",
        "host_version_fails",
        "initialize_version_fails",
        "null_stage_descriptor",
    ]
]
